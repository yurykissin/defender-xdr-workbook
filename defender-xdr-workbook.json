{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "parameters": {
    "workbookDisplayName": {
      "type": "string",
      "defaultValue": "MDE Device Hygiene & Health",
      "metadata": {
        "description": "Display name of the workbook"
      }
    },
    "workbookId": {
      "type": "string",
      "defaultValue": "[newGuid()]",
      "metadata": {
        "description": "The unique guid for this workbook instance"
      }
    },
    "location": {
      "type": "string",
      "defaultValue": "[resourceGroup().location]",
      "metadata": {
        "description": "Location for the workbook resource"
      }
    }
  },
  "variables": {
    "workbookContent": {
      "version": "Notebook/1.0",
      "items": [
        {
          "type": 1,
          "content": {
            "json": "# MDE Device Hygiene & Health Dashboard\n---\nMonitors ~2K Azure VMs with manually onboarded Defender for Endpoint agents.\nIdentifies stale/ghost devices, unhealthy sensors, and network connectivity issues."
          },
          "name": "header"
        },
        {
          "type": 9,
          "content": {
            "version": "KqlParameterItem/1.0",
            "parameters": [
              {
                "id": "sub_selector",
                "version": "KqlParameterItem/1.0",
                "name": "Subscription",
                "type": 6,
                "isRequired": true,
                "multiSelect": false,
                "typeSettings": {
                  "additionalResourceOptions": [],
                  "includeAll": false,
                  "showDefault": false
                },
                "label": "Subscription"
              },
              {
                "id": "workspace_selector",
                "version": "KqlParameterItem/1.0",
                "name": "Workspace",
                "type": 5,
                "isRequired": true,
                "multiSelect": false,
                "query": "Resources\n| where type =~ 'microsoft.operationalinsights/workspaces'\n| order by name asc\n| extend Rank = row_number()\n| project value = id, label = name, selected = Rank == 1, group = resourceGroup",
                "crossComponentResources": [
                  "{Subscription}"
                ],
                "typeSettings": {
                  "additionalResourceOptions": [],
                  "showDefault": false
                },
                "queryType": 1,
                "resourceType": "microsoft.resourcegraph/resources",
                "label": "Log Analytics Workspace"
              },
              {
                "id": "time_range",
                "version": "KqlParameterItem/1.0",
                "name": "TimeRange",
                "type": 4,
                "isRequired": true,
                "value": {
                  "durationMs": 86400000
                },
                "typeSettings": {
                  "selectableValues": [
                    {
                      "durationMs": 3600000
                    },
                    {
                      "durationMs": 14400000
                    },
                    {
                      "durationMs": 43200000
                    },
                    {
                      "durationMs": 86400000
                    },
                    {
                      "durationMs": 259200000
                    },
                    {
                      "durationMs": 604800000
                    },
                    {
                      "durationMs": 2592000000
                    },
                    {
                      "durationMs": 7776000000
                    }
                  ]
                },
                "label": "Time Range"
              },
              {
                "id": "stale_threshold",
                "version": "KqlParameterItem/1.0",
                "name": "StaleThresholdDays",
                "type": 1,
                "isRequired": true,
                "value": "14",
                "label": "Stale Threshold (days)"
              }
            ]
          },
          "name": "parameters"
        },
        {
          "type": 1,
          "content": {
            "json": "## Overview"
          },
          "name": "section-overview"
        },
        {
          "type": 3,
          "content": {
            "version": "KqlItem/1.0",
            "query": "DeviceInfo\n| where Timestamp > ago(90d)\n| summarize LastSeen = arg_max(Timestamp, *) by DeviceId\n| summarize\n    TotalDevices = dcount(DeviceId),\n    ActiveLast24h = dcountif(DeviceId, LastSeen > ago(1d)),\n    ActiveLast7d = dcountif(DeviceId, LastSeen > ago(7d)),\n    StaleOver14d = dcountif(DeviceId, LastSeen < ago(14d)),\n    StaleOver30d = dcountif(DeviceId, LastSeen < ago(30d)),\n    Healthy = dcountif(DeviceId, SensorHealthState == \"Active\"),\n    Unhealthy = dcountif(DeviceId, SensorHealthState != \"Active\" and SensorHealthState != \"\")",
            "size": 4,
            "title": "Device Inventory at a Glance",
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces",
            "visualization": "tiles",
            "tileSettings": {
              "titleContent": {
                "columnMatch": "Column1",
                "formatter": 1
              },
              "leftContent": {
                "columnMatch": "TotalDevices",
                "formatter": 12,
                "formatOptions": {
                  "palette": "auto"
                }
              },
              "showBorder": true
            },
            "crossComponentResources": [
              "{Workspace}"
            ]
          },
          "name": "overview-tiles"
        },
        {
          "type": 3,
          "content": {
            "version": "KqlItem/1.0",
            "query": "DeviceInfo\n| where Timestamp > ago(1d)\n| summarize arg_max(Timestamp, *) by DeviceId\n| extend SensorHealthState = iff(isempty(SensorHealthState), \"Unknown\", SensorHealthState)\n| summarize Count = count() by SensorHealthState\n| sort by Count desc",
            "size": 2,
            "title": "Sensor Health Distribution",
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces",
            "visualization": "piechart",
            "chartSettings": {
              "seriesLabelSettings": [
                {
                  "seriesName": "Active",
                  "color": "green"
                },
                {
                  "seriesName": "Inactive",
                  "color": "red"
                },
                {
                  "seriesName": "ImpairedCommunication",
                  "color": "orange"
                },
                {
                  "seriesName": "NoSensorData",
                  "color": "gray"
                }
              ]
            },
            "crossComponentResources": [
              "{Workspace}"
            ]
          },
          "customWidth": "50",
          "name": "health-pie"
        },
        {
          "type": 3,
          "content": {
            "version": "KqlItem/1.0",
            "query": "DeviceInfo\n| where Timestamp > ago(1d)\n| summarize arg_max(Timestamp, *) by DeviceId\n| summarize Count = count() by OSPlatform\n| sort by Count desc",
            "size": 2,
            "title": "OS Platform Distribution",
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces",
            "visualization": "piechart",
            "crossComponentResources": [
              "{Workspace}"
            ]
          },
          "customWidth": "50",
          "name": "os-pie"
        },
        {
          "type": 1,
          "content": {
            "json": "## Stale & Ghost Devices\nDevices not seen in {StaleThresholdDays}+ days â€” likely decommissioned VMs creating phantom entries."
          },
          "name": "section-stale"
        },
        {
          "type": 3,
          "content": {
            "version": "KqlItem/1.0",
            "query": "DeviceInfo\n| summarize LastSeen = arg_max(Timestamp, *) by DeviceId\n| extend AgeBucket = case(\n    LastSeen > ago(7d), \"1. 0-7d (Active)\",\n    LastSeen > ago(14d), \"2. 7-14d\",\n    LastSeen > ago(30d), \"3. 14-30d (Stale)\",\n    LastSeen > ago(60d), \"4. 30-60d (Very Stale)\",\n    LastSeen > ago(90d), \"5. 60-90d\",\n    \"6. 90d+ (Ghost)\")\n| summarize DeviceCount = dcount(DeviceId) by AgeBucket\n| sort by AgeBucket asc",
            "size": 1,
            "title": "Device Staleness Distribution",
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces",
            "visualization": "barchart",
            "chartSettings": {
              "xAxis": "AgeBucket",
              "yAxis": [
                "DeviceCount"
              ],
              "seriesLabelSettings": [
                {
                  "seriesName": "DeviceCount",
                  "label": "Devices"
                }
              ]
            },
            "crossComponentResources": [
              "{Workspace}"
            ]
          },
          "name": "stale-bar"
        },
        {
          "type": 3,
          "content": {
            "version": "KqlItem/1.0",
            "query": "let threshold = toint(\"{StaleThresholdDays}\");\nDeviceInfo\n| summarize LastSeen = arg_max(Timestamp, *) by DeviceId\n| where LastSeen < ago(totimespan(strcat(threshold, \"d\")))\n| project\n    DeviceId,\n    DeviceName,\n    OSPlatform,\n    OSVersionInfo,\n    LastSeen,\n    DaysSinceLastSeen = datetime_diff('day', now(), LastSeen),\n    SensorHealthState,\n    OnboardingStatus,\n    MachineGroup\n| sort by DaysSinceLastSeen desc",
            "size": 0,
            "title": "Stale Device List",
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces",
            "visualization": "table",
            "gridSettings": {
              "formatters": [
                {
                  "columnMatch": "DaysSinceLastSeen",
                  "formatter": 8,
                  "formatOptions": {
                    "palette": "redGreen",
                    "min": 14,
                    "max": 90
                  }
                },
                {
                  "columnMatch": "SensorHealthState",
                  "formatter": 18,
                  "formatOptions": {
                    "thresholdsOptions": "icons",
                    "thresholdsGrid": [
                      {
                        "operator": "==",
                        "thresholdValue": "Active",
                        "representation": "success",
                        "text": "{0}"
                      },
                      {
                        "operator": "Default",
                        "representation": "critical",
                        "text": "{0}"
                      }
                    ]
                  }
                }
              ],
              "filter": true,
              "sortBy": [
                {
                  "itemKey": "DaysSinceLastSeen",
                  "sortOrder": 2
                }
              ]
            },
            "exportFieldName": "DeviceId",
            "exportParameterName": "SelectedStaleDevice",
            "crossComponentResources": [
              "{Workspace}"
            ]
          },
          "name": "stale-table"
        },
        {
          "type": 1,
          "content": {
            "json": "## Unhealthy Devices\nActive VMs reporting a non-Active sensor state â€” likely blocked network traffic."
          },
          "name": "section-unhealthy"
        },
        {
          "type": 3,
          "content": {
            "version": "KqlItem/1.0",
            "query": "DeviceInfo\n| where Timestamp > ago(7d)\n| summarize arg_max(Timestamp, *) by DeviceId\n| where SensorHealthState != \"Active\" and SensorHealthState != \"\"\n| project\n    DeviceId,\n    DeviceName,\n    OSPlatform,\n    OSVersionInfo,\n    SensorHealthState,\n    OnboardingStatus,\n    LastSeen = Timestamp,\n    MachineGroup,\n    PublicIP,\n    IsInternetFacing\n| sort by SensorHealthState asc, DeviceName asc",
            "size": 0,
            "title": "Unhealthy Active Devices",
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces",
            "visualization": "table",
            "gridSettings": {
              "formatters": [
                {
                  "columnMatch": "SensorHealthState",
                  "formatter": 18,
                  "formatOptions": {
                    "thresholdsOptions": "icons",
                    "thresholdsGrid": [
                      {
                        "operator": "==",
                        "thresholdValue": "Inactive",
                        "representation": "critical",
                        "text": "{0}"
                      },
                      {
                        "operator": "==",
                        "thresholdValue": "ImpairedCommunication",
                        "representation": "warning",
                        "text": "{0}"
                      },
                      {
                        "operator": "==",
                        "thresholdValue": "NoSensorData",
                        "representation": "unknown",
                        "text": "{0}"
                      },
                      {
                        "operator": "Default",
                        "representation": "critical",
                        "text": "{0}"
                      }
                    ]
                  }
                }
              ],
              "filter": true
            },
            "crossComponentResources": [
              "{Workspace}"
            ]
          },
          "name": "unhealthy-table"
        },
        {
          "type": 3,
          "content": {
            "version": "KqlItem/1.0",
            "query": "DeviceInfo\n| summarize arg_max(Timestamp, *) by DeviceId\n| where OnboardingStatus == \"Onboarded\"\n| where SensorHealthState != \"Active\" and SensorHealthState != \"\"\n| where Timestamp > ago(30d)\n| project\n    DeviceId,\n    DeviceName,\n    OSPlatform,\n    SensorHealthState,\n    OnboardingStatus,\n    LastSeen = Timestamp,\n    DaysSinceLastSeen = datetime_diff('day', now(), Timestamp),\n    PublicIP,\n    MachineGroup\n| sort by DaysSinceLastSeen desc",
            "size": 0,
            "title": "Onboarded But Never Healthy (agent never connected)",
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces",
            "visualization": "table",
            "gridSettings": {
              "formatters": [
                {
                  "columnMatch": "DaysSinceLastSeen",
                  "formatter": 8,
                  "formatOptions": {
                    "palette": "redGreen",
                    "min": 0,
                    "max": 30
                  }
                }
              ],
              "filter": true
            },
            "crossComponentResources": [
              "{Workspace}"
            ]
          },
          "name": "onboarded-unhealthy-table"
        },
        {
          "type": 1,
          "content": {
            "json": "## Network Connectivity\nDevices failing to reach MDE cloud endpoints â€” root cause of unhealthy sensors."
          },
          "name": "section-network"
        },
        {
          "type": 3,
          "content": {
            "version": "KqlItem/1.0",
            "query": "DeviceNetworkEvents\n| where Timestamp > ago(7d)\n| where RemoteUrl has_any (\n    \"securitycenter.windows.com\",\n    \"winatp-gw\",\n    \"events.data.microsoft.com\",\n    \"endpoint.security.microsoft.com\",\n    \"ussus1eastprod.blob.core.windows.net\",\n    \"ussus1westprod.blob.core.windows.net\")\n| where ActionType in (\"ConnectionFailed\", \"ConnectionAttempt\")\n| summarize\n    FailedConnections = countif(ActionType == \"ConnectionFailed\"),\n    TotalAttempts = count()\n    by DeviceName, RemoteUrl\n| where FailedConnections > 0\n| sort by FailedConnections desc",
            "size": 0,
            "title": "Failed Connections to MDE Endpoints (Last 7 Days)",
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces",
            "visualization": "table",
            "gridSettings": {
              "formatters": [
                {
                  "columnMatch": "FailedConnections",
                  "formatter": 8,
                  "formatOptions": {
                    "palette": "redGreen",
                    "min": 1,
                    "max": 100
                  }
                }
              ],
              "filter": true
            },
            "crossComponentResources": [
              "{Workspace}"
            ]
          },
          "name": "network-failures-table"
        },
        {
          "type": 3,
          "content": {
            "version": "KqlItem/1.0",
            "query": "DeviceNetworkEvents\n| where Timestamp > ago(7d)\n| where ActionType == \"ConnectionFailed\"\n| where RemotePort in (443, 80)\n| where RemoteUrl has_any (\n    \"securitycenter.windows.com\",\n    \"winatp-gw\",\n    \"events.data.microsoft.com\",\n    \"endpoint.security.microsoft.com\")\n| summarize FailedDevices = dcount(DeviceName) by RemoteUrl, bin(Timestamp, 1d)\n| sort by Timestamp asc",
            "size": 0,
            "title": "Daily Failed Connection Trend by MDE Endpoint",
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces",
            "visualization": "linechart",
            "chartSettings": {
              "xAxis": "Timestamp",
              "yAxis": [
                "FailedDevices"
              ],
              "group": "RemoteUrl",
              "showLegend": true
            },
            "crossComponentResources": [
              "{Workspace}"
            ]
          },
          "name": "network-trend-chart"
        },
        {
          "type": 3,
          "content": {
            "version": "KqlItem/1.0",
            "query": "DeviceNetworkEvents\n| where Timestamp > ago(7d)\n| where ActionType == \"ConnectionFailed\"\n| where RemotePort in (443, 80)\n| where RemoteUrl has_any (\n    \"securitycenter.windows.com\",\n    \"winatp-gw\",\n    \"events.data.microsoft.com\",\n    \"endpoint.security.microsoft.com\")\n| summarize\n    BlockCount = count(),\n    FirstSeen = min(Timestamp),\n    LastSeen = max(Timestamp)\n    by DeviceId, DeviceName, RemoteUrl, RemotePort, LocalIP\n| sort by BlockCount desc",
            "size": 0,
            "title": "Firewall/NSG Blocks to MDE Service URLs",
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces",
            "visualization": "table",
            "gridSettings": {
              "formatters": [
                {
                  "columnMatch": "BlockCount",
                  "formatter": 8,
                  "formatOptions": {
                    "palette": "red",
                    "min": 1,
                    "max": 500
                  }
                }
              ],
              "filter": true
            },
            "crossComponentResources": [
              "{Workspace}"
            ]
          },
          "name": "firewall-blocks-table"
        },
        {
          "type": 1,
          "content": {
            "json": "## Duplicates & Cleanup"
          },
          "name": "section-duplicates"
        },
        {
          "type": 3,
          "content": {
            "version": "KqlItem/1.0",
            "query": "DeviceInfo\n| summarize arg_max(Timestamp, *) by DeviceId\n| summarize\n    DeviceCount = dcount(DeviceId),\n    DeviceIds = make_set(DeviceId, 5),\n    LatestSeen = max(Timestamp),\n    EarliestSeen = min(Timestamp),\n    HealthStates = make_set(SensorHealthState)\n    by DeviceName\n| where DeviceCount > 1\n| sort by DeviceCount desc",
            "size": 0,
            "title": "Duplicate Device Names (same hostname, multiple MDE records)",
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces",
            "visualization": "table",
            "gridSettings": {
              "formatters": [
                {
                  "columnMatch": "DeviceCount",
                  "formatter": 8,
                  "formatOptions": {
                    "palette": "yellowOrangeRed",
                    "min": 2,
                    "max": 10
                  }
                }
              ],
              "filter": true
            },
            "crossComponentResources": [
              "{Workspace}"
            ]
          },
          "name": "duplicates-table"
        },
        {
          "type": 3,
          "content": {
            "version": "KqlItem/1.0",
            "query": "DeviceInfo\n| summarize LastSeen = arg_max(Timestamp, *) by DeviceId\n| where LastSeen < ago(30d)\n| where SensorHealthState != \"Active\"\n| project\n    DeviceId,\n    DeviceName,\n    OSPlatform,\n    SensorHealthState,\n    OnboardingStatus,\n    LastSeen,\n    DaysSinceLastSeen = datetime_diff('day', now(), LastSeen),\n    MachineGroup\n| sort by DaysSinceLastSeen desc",
            "size": 0,
            "title": "ðŸ—‘ï¸ Cleanup Candidates â€” Safe to Offboard (30+ days stale, not Active)",
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces",
            "visualization": "table",
            "gridSettings": {
              "formatters": [
                {
                  "columnMatch": "DaysSinceLastSeen",
                  "formatter": 8,
                  "formatOptions": {
                    "palette": "redGreen",
                    "min": 30,
                    "max": 120
                  }
                }
              ],
              "filter": true
            },
            "crossComponentResources": [
              "{Workspace}"
            ]
          },
          "name": "cleanup-table"
        },
        {
          "type": 1,
          "content": {
            "json": "## Active Devices\nDevices seen in the last 7 days with an Active sensor health state."
          },
          "name": "section-active"
        },
        {
          "type": 3,
          "content": {
            "version": "KqlItem/1.0",
            "query": "DeviceInfo\n| where Timestamp > ago(7d)\n| summarize arg_max(Timestamp, *) by DeviceId\n| where SensorHealthState == \"Active\"\n| summarize\n    ActiveDevices = dcount(DeviceId),\n    Windows = dcountif(DeviceId, OSPlatform startswith \"Windows\"),\n    Linux = dcountif(DeviceId, OSPlatform startswith \"Linux\"),\n    MacOS = dcountif(DeviceId, OSPlatform == \"macOS\")",
            "size": 4,
            "title": "Active Device Summary",
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces",
            "visualization": "tiles",
            "tileSettings": {
              "titleContent": {
                "columnMatch": "Column1",
                "formatter": 1
              },
              "leftContent": {
                "columnMatch": "ActiveDevices",
                "formatter": 12,
                "formatOptions": {
                  "palette": "auto"
                }
              },
              "showBorder": true
            },
            "crossComponentResources": [
              "{Workspace}"
            ]
          },
          "name": "active-summary-tiles"
        },
        {
          "type": 3,
          "content": {
            "version": "KqlItem/1.0",
            "query": "DeviceInfo\n| where Timestamp > ago(7d)\n| summarize arg_max(Timestamp, *) by DeviceId\n| where SensorHealthState == \"Active\"\n| project\n    DeviceName,\n    OSPlatform,\n    OSVersionInfo,\n    LastSeen = Timestamp,\n    OnboardingStatus,\n    MachineGroup,\n    PublicIP,\n    IsInternetFacing\n| sort by DeviceName asc",
            "size": 0,
            "title": "Active Device List",
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces",
            "visualization": "table",
            "gridSettings": {
              "formatters": [
                {
                  "columnMatch": "LastSeen",
                  "formatter": 6
                }
              ],
              "filter": true
            },
            "crossComponentResources": [
              "{Workspace}"
            ]
          },
          "name": "active-devices-table"
        },
        {
          "type": 1,
          "content": {
            "json": "## Active Fleet Health"
          },
          "name": "section-fleet"
        },
        {
          "type": 3,
          "content": {
            "version": "KqlItem/1.0",
            "query": "DeviceInfo\n| where Timestamp > ago(1d)\n| summarize arg_max(Timestamp, *) by DeviceId\n| summarize Count = dcount(DeviceId) by SensorHealthState, OSPlatform, MachineGroup\n| sort by Count desc",
            "size": 0,
            "title": "Active VMs by Health State, OS & Machine Group",
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces",
            "visualization": "table",
            "gridSettings": {
              "formatters": [
                {
                  "columnMatch": "SensorHealthState",
                  "formatter": 18,
                  "formatOptions": {
                    "thresholdsOptions": "icons",
                    "thresholdsGrid": [
                      {
                        "operator": "==",
                        "thresholdValue": "Active",
                        "representation": "success",
                        "text": "{0}"
                      },
                      {
                        "operator": "Default",
                        "representation": "critical",
                        "text": "{0}"
                      }
                    ]
                  }
                },
                {
                  "columnMatch": "Count",
                  "formatter": 4,
                  "formatOptions": {
                    "palette": "blue",
                    "min": 0
                  }
                }
              ],
              "hierarchies": [
                {
                  "id": "health-os",
                  "by": "SensorHealthState"
                }
              ],
              "filter": true
            },
            "crossComponentResources": [
              "{Workspace}"
            ]
          },
          "name": "fleet-health-table"
        },
        {
          "type": 3,
          "content": {
            "version": "KqlItem/1.0",
            "query": "DeviceInfo\n| where Timestamp > ago(30d)\n| summarize arg_max(Timestamp, *) by DeviceId, bin(Timestamp, 1d)\n| summarize\n    ActiveDevices = dcountif(DeviceId, SensorHealthState == \"Active\"),\n    UnhealthyDevices = dcountif(DeviceId, SensorHealthState != \"Active\" and SensorHealthState != \"\")\n    by bin(Timestamp, 1d)\n| sort by Timestamp asc",
            "size": 0,
            "title": "Healthy vs Unhealthy Devices Over Last 30 Days",
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces",
            "visualization": "areachart",
            "chartSettings": {
              "xAxis": "Timestamp",
              "yAxis": [
                "ActiveDevices",
                "UnhealthyDevices"
              ],
              "showLegend": true,
              "seriesLabelSettings": [
                {
                  "seriesName": "ActiveDevices",
                  "color": "green",
                  "label": "Healthy"
                },
                {
                  "seriesName": "UnhealthyDevices",
                  "color": "red",
                  "label": "Unhealthy"
                }
              ]
            },
            "crossComponentResources": [
              "{Workspace}"
            ]
          },
          "name": "health-trend-chart"
        }
      ],
      "isLocked": false,
      "fallbackResourceIds": [
        "azure monitor"
      ]
    }
  },
  "resources": [
    {
      "type": "Microsoft.Insights/workbooks",
      "apiVersion": "2022-04-01",
      "name": "[parameters('workbookId')]",
      "location": "[parameters('location')]",
      "kind": "shared",
      "properties": {
        "displayName": "[parameters('workbookDisplayName')]",
        "serializedData": "[string(variables('workbookContent'))]",
        "version": "1.0",
        "sourceId": "azure monitor",
        "category": "workbook"
      }
    }
  ],
  "outputs": {
    "workbookId": {
      "type": "string",
      "value": "[resourceId('Microsoft.Insights/workbooks', parameters('workbookId'))]"
    }
  }
}